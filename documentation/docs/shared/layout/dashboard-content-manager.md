---
sidebar_position: 21
title: DashboardContentManager
---

# 🏗️ Dashboard Content Manager Component

کامپوننت `DashboardContentManagerComponent` قلب سیستم تب‌های پویا است. وظیفه اصلی آن **بارگذاری و مدیریت چرخه حیات کامپوننت‌های Angular** در فضای محتوای یک تب فعال است. این کامپوننت از قابلیت‌های پیشرفته انگولار مانند `ViewContainerRef` برای ایجاد و نگهداری کامپوننت‌ها در حافظه استفاده می‌کند تا هنگام جابجایی کاربر بین تب‌های اصلی یا فرعی، محتوا سریعاً بازیابی شود و از بارگذاری مجدد غیرضروری جلوگیری شود.

---

## ⚙️ ساختار و وابستگی‌ها

- **`@ViewChild('tabContent', { read: ViewContainerRef })`**: این دکوراتور دسترسی به یک ناحیه خاص در DOM را فراهم می‌کند که به عنوان کانتینر برای تمام کامپوننت‌های پویا عمل می‌کند.
- **NgRx Store**: این کامپوننت برای به‌روزرسانی نوار کناری (Sidebar) و دریافت اطلاعات مربوط به فرآیندهای وب، به استور وابسته است.

## 🧠 منطق اصلی: `loadTabContent`

این متد توسط `TabManagerComponent` فراخوانی می‌شود و محتوای تب فعال را مدیریت می‌کند.

| گام                             | متد                      | توضیح عملکرد                                                                                                                                                                  |
| :------------------------------ | :----------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **۱. بررسی وضعیت**              | -                        | بررسی می‌کند که آیا محتوای فعال فعلی همان محتوای درخواستی است یا نه (با در نظر گرفتن `selectedSubTab`). اگر یکسان بود و نوار کناری بسته بود، از بارگذاری مجدد جلوگیری می‌کند. |
| **۲. پاکسازی**                  | `clearPreviousContent()` | محتوای قبلی را از `ViewContainerRef` جدا (Detach) می‌کند. این کار اجازه می‌دهد تا محتوا بدون از بین رفتن (Destroy)، موقتاً از DOM خارج شود.                                   |
| **۳. بررسی حافظه نهان (Cache)** | `cachedComponent.get()`  | بررسی می‌کند که آیا نمونه‌ای از کامپوننت مربوط به Sub-Tab فعلی قبلاً ایجاد و در `DynamicTab.cachedComponent` ذخیره شده است یا خیر.                                            |
| **۴. بارگذاری (Cached)**        | `loadCachedComponent()`  | اگر نمونه ذخیره‌شده وجود داشته باشد، `hostView` آن کامپوننت را دوباره به `tabContent` وارد (Insert) می‌کند.                                                                   |
| **۵. ایجاد (New)**              | `createNewComponent()`   | اگر نمونه ذخیره‌شده وجود نداشته باشد، کامپوننت جدید را ایجاد کرده، داده‌های ورودی را اختصاص داده و آن را در `cachedComponent` ذخیره می‌کند.                                   |

---

## 🧩 توابع بارگذاری و مدیریت

### ۱. توابع مدیریت چرخه حیات

| متد                                          | نوع    | توضیح                                                                                                                                                                                        |
| :------------------------------------------- | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`clearPreviousContent()`**                 | `void` | محتوای فعلی موجود در `ViewContainerRef` را با استفاده از `this.tabContent.detach(0)` از DOM جدا می‌کند. این کار برای جابجایی بین محتوا ضروری است.                                            |
| **`loadCachedComponent(componentRef, tab)`** | `void` | کامپوننت ذخیره‌شده را مجدداً به DOM اضافه می‌کند (`insert`)، متد `onViewActivated()` را روی آن فراخوانی می‌کند (برای ری‌اکتیو کردن کامپوننت) و یک `renderContent` به استور ارسال می‌کند.     |
| **`createNewComponent(tab: DynamicTab)`**    | `void` | نوع کامپوننت مورد نیاز را از `tab.config.subTab` استخراج کرده و آن را در `ViewContainerRef` ایجاد (`createComponent`) می‌کند، سپس آن را ذخیره می‌کند.                                        |
| **`activateComponent(instance: any)`**       | `void` | متد اختیاری `onViewActivated()` را روی کامپوننت‌های پویا فراخوانی می‌کند. این متد به کامپوننت‌های داخلی اجازه می‌دهد تا پس از بازگشت از حالت غیرفعال (Detach)، منطق خود را مجدداً فعال کنند. |

### ۲. توابع اختصاص داده (Data Assignment)

| متد                                                | نوع    | توضیح                                                                                                                                                                                                                                    |
| :------------------------------------------------- | :----- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`assignStaticData(componentRef, data)`**         | `void` | داده‌های استاتیک تعریف شده در `TabConfig` را به ویژگی‌های (Properties) اینستنس کامپوننت پویا اختصاص می‌دهد (`Object.assign`).                                                                                                            |
| **`setupSharedSignal(componentRef, tab, config)`** | `void` | اگر `TabConfig` نیازمند `sharedSignal` باشد، این متد آن را روی آبجکت `DynamicTab` ایجاد می‌کند (در صورت عدم وجود) و آن را به اینستنس کامپوننت پویا اختصاص می‌دهد تا کامپوننت‌های داخلی بتوانند وضعیت خود را با یکدیگر به اشتراک بگذارند. |
| **`sendRenderContent(tab: DynamicTab)`**           | `void` | پس از بارگذاری موفقیت‌آمیز محتوا، یک اکشن **`renderContent`** به استور ارسال می‌کند تا **نوار کناری (Sidebar)** با اطلاعات (عنوان و آیکون) تب فعلی به‌روزرسانی شود.                                                                      |

### ۳. مدیریت نوار کناری (Sidebar)

- **`setupSubscriptions()`**: دو سابسکریپشن NgRx حیاتی را راه‌اندازی می‌کند:
  - **`selectSelectedPageGroup`**: داده‌های **`WebProcesses`** (مانند لیست دکمه‌های نوار کناری) را برای نمایش در `SidebarWebProcesses` استخراج می‌کند.
  - **`selectContentState`**: وضعیت `context` را رصد می‌کند تا متغیر `subMenuVisible` را به‌روز کند. اگر `context` روی `'subMenu'` تنظیم شود، منطق بارگذاری محتوا به‌روز می‌شود تا امکان بازگشت به نمای تب محتوای اصلی را فراهم کند.
