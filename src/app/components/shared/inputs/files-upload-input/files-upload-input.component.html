<div class="flex justify-center">
  <div class="w-full">
    <p-fileupload
      name="files[]"
      url="https://www.primefaces.org/cdn/api/upload.php"
      [multiple]="true"
      [accept]="accept()"
      [maxFileSize]="maxFileSize()"
      mode="advanced"
      (onSelect)="onSelectedFiles($event)"
    >
      <!-- Header -->
      <ng-template
        #header
        let-chooseCallback="chooseCallback"
        let-clearCallback="clearCallback"
      >
        <div class="flex justify-between items-center flex-wrap gap-4">
          <div class="flex gap-2">
            <p-button
              (onClick)="choose($event, chooseCallback)"
              icon="pi pi-images"
              [rounded]="true"
              [outlined]="true"
            />
            <p-button
              (onClick)="onClearTemplatingUpload(clearCallback)"
              icon="pi pi-times"
              [rounded]="true"
              [outlined]="true"
              severity="danger"
              [disabled]="files().length === 0"
            />
          </div>
        </div>
      </ng-template>

      <!-- Content -->
      <ng-template
        #content
        let-chooseCallback="chooseCallback"
        let-uploadedFiles="uploadedFiles"
        let-removeFileCallback="removeFileCallback"
      >
        <div class="flex flex-col gap-3 pt-4">
          @for (file of files(); track $index) {
            <div
              class="relative flex flex-col md:flex-row items-center justify-between border border-surface rounded-lg p-4 shadow-sm hover:shadow-md transition-all"
            >
              <!-- File preview -->
              <div
                class="flex mt-5 flex-col md:flex-row items-center gap-4 w-full"
              >
                <div
                  class="w-[80px] h-[80px] flex items-center justify-center border rounded-md overflow-hidden shrink-0"
                >
                  @if (
                    file.raw.type.startsWith("image/") &&
                    $any(file.raw).objectURL
                  ) {
                    <img
                      [src]="$any(file.raw).objectURL"
                      [alt]="file.raw.name"
                      class="w-full h-full object-cover"
                    />
                  } @else {
                    <i class="pi pi-file text-4xl text-muted-color"></i>
                  }
                </div>

                <!-- File info -->
                <div class="flex flex-col gap-1 w-[70%] max-w-[400px]">
                  <span
                    class="font-medium text-base text-ellipsis whitespace-nowrap overflow-hidden text-center md:text-right"
                  >
                    {{ file.raw.name }}
                  </span>
                  <small class="text-muted-color text-center md:text-right">
                    {{ formatSize(file.raw.size) }}
                  </small>
                  <p-progress-bar
                    [hidden]="file.status !== UploadFileStatus.Uploading"
                    [value]="file.progress"
                    [showValue]="false"
                    class="h-2 mt-2 rounded-md"
                  />

                  <div
                    class="absolute top-2 right-2 scale-80 w-auto md:w-[93px] flex items-center justify-center"
                  >
                    @switch (file.status) {
                      @case (UploadFileStatus.Success) {
                        <p-badge
                          value="موفق"
                          severity="success"
                          size="small"
                          class="text-sm px-4 py-2 rounded-md"
                        />
                      }
                      @case (UploadFileStatus.Uploading) {
                        <p-badge
                          value="بارگزاری ..."
                          severity="info"
                          size="small"
                          class="text-sm px-2 py-1 rounded-md"
                        />
                      }
                      @case (UploadFileStatus.Failed) {
                        <p-badge
                          value="ناموفق"
                          severity="danger"
                          size="small"
                          class="text-sm px-4 py-2 rounded-md"
                        />
                      }
                    }
                  </div>
                </div>
              </div>

              <!-- Remove button -->
              <p-button
                icon="pi pi-times"
                (click)="
                  onRemoveTemplatingFile(
                    $event,
                    file,
                    removeFileCallback,
                    $index
                  )
                "
                [outlined]="true"
                [rounded]="true"
                severity="danger"
                class="absolute top-2 left-2 scale-80 md:scale-100 md:top-0 md:left-0 md:ml-4 md:relative"
              />
            </div>
          } @empty {
            <div
              (click)="choose($event, chooseCallback)"
              class="flex flex-col items-center cursor-pointer hover:bg-surface-100 dark:hover:bg-surface-950 justify-center border-2 border-dashed rounded-lg py-10 text-center text-muted-color transition-colors"
            >
              <i class="pi pi-upload text-5xl mb-3 text-muted-color"></i>
              <p class="text-lg font-medium text-surface-600">
                فایل‌های خود را اینجا بکشید و رها کنید
              </p>
              <p class="text-sm text-surface-500 mt-1">
                یا از دکمه بالا برای انتخاب فایل استفاده کنید
              </p>
            </div>
          }
        </div>
      </ng-template>
    </p-fileupload>
  </div>
</div>
