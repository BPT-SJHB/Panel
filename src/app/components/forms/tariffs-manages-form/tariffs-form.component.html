<!-- ðŸ” Search Form -->
<form
  class="grid grid-cols-12 gap-4 mb-6"
  [formGroup]="tariffForm"
  (ngSubmit)="searchTariffs()"
>
  <app-search-auto-complete
    class="col-span-12 sm:col-span-6 lg:col-span-4"
    placeholder="Ù†ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±"
    label="Ù†ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±"
    optionLabel="LoaderTypeTitle"
    optionValue="LoaderTypeTitle"
    (selectSuggestion)="onSelectSearchLoaderType($event)"
    (valueChange)="onAutoCompleteChange(searchLoaderTypeId)"
    [lazySearch]="onSearchLoaderType"
    [showIconOptionSelected]="searchLoaderTypeId.value !== 0"
    [addonWidth]="widthAddon"
  />

  <app-search-auto-complete
    class="col-span-12 sm:col-span-6 lg:col-span-4"
    placeholder="Ø´Ù‡Ø± Ù…Ø¨Ø¯Ø§"
    label="Ø´Ù‡Ø± Ù…Ø¨Ø¯Ø§"
    [control]="searchSourceCity"
    optionLabel="CityTitle"
    optionValue="CityTitle"
    (selectSuggestion)="onSelectSearchSourceCity($event)"
    (valueChange)="onAutoCompleteChange(searchSourceCityId)"
    [lazySearch]="onSearchCity"
    [showIconOptionSelected]="searchSourceCityId.value !== 0"
    [addonWidth]="widthAddon"
  />

  <app-search-auto-complete
    class="col-span-12 sm:col-span-6 lg:col-span-4"
    placeholder="Ø´Ù‡Ø± Ù…Ù‚ØµØ¯"
    label="Ø´Ù‡Ø± Ù…Ù‚ØµØ¯"
    [control]="searchTargetCity"
    optionLabel="CityTitle"
    optionValue="CityTitle"
    (selectSuggestion)="onSelectSearchTargetCity($event)"
    (valueChange)="onAutoCompleteChange(searchTargetCityId)"
    [lazySearch]="onSearchCity"
    [showIconOptionSelected]="searchTargetCityId.value !== 0"
    [addonWidth]="widthAddon"
  />

  <app-search-auto-complete
    class="col-span-12 sm:col-span-6 lg:col-span-4"
    placeholder="Ù†ÙˆØ¹ Ø¨Ø§Ø±"
    label="Ù†ÙˆØ¹ Ø¨Ø§Ø±"
    [control]="searchGoods"
    optionLabel="ProductTitle"
    optionValue="ProductTitle"
    (selectSuggestion)="onSelectSearchProduct($event)"
    (valueChange)="onAutoCompleteChange(searchGoodsId)"
    [lazySearch]="onSearchProduct"
    [showIconOptionSelected]="searchGoodsId.value !== 0"
    [addonWidth]="widthAddon"
  />

  <div class="col-span-12 flex justify-end">
    <app-button
      label="Ø¬Ø³ØªØ¬Ùˆ"
      severity="info"
      size="small"
      styleClass="px-6 py-1"
      [disabled]="!isSearchFormValid()"
      type="submit"
    />
  </div>
</form>

<!-- ðŸ“Š Tariff Table -->
<p-table
  class="col-span-12 overflow-x-auto"
  [columns]="cols"
  [value]="tariffs"
  [tableStyle]="{ 'min-width': '50rem' }"
>
  <ng-template #caption>
    <div class="flex justify-between items-center">
      <app-button
        label="Ø¬Ø¯ÛŒØ¯"
        size="small"
        styleClass="px-6 md:px-8 py-1"
        (click)="onNew()"
      />
    </div>
  </ng-template>

  <ng-template #header let-columns>
    <tr>
      @for (col of columns; track $index) {
      <th>{{ col }}</th>
      }
    </tr>
  </ng-template>

  <ng-template #body let-rowData>
    <tr>
      <td>
        <app-button
          icon="pi pi-pencil"
          severity="info"
          variant="text"
          [disabled]="loading"
          (click)="onEdit(rowData)"
        />
      </td>
      <td>
        <app-button
          icon="pi pi-trash"
          severity="danger"
          variant="text"
          [disabled]="loading"
          (click)="onDelete(rowData)"
        />
      </td>
      <td>{{ rowData.LoaderTypeId }}</td>
      <td>{{ rowData.LoaderTypeTitle }}</td>
      <td>{{ rowData.GoodId }}</td>
      <td>{{ rowData.GoodTitle }}</td>
      <td>{{ rowData.SourceCityId }}</td>
      <td>{{ rowData.SourceCityTitle }}</td>
      <td>{{ rowData.TargetCityId }}</td>
      <td>{{ rowData.TargetCityTitle }}</td>
      <td>{{ rowData.Tariff }}</td>
      <td>{{ rowData.BaseTonnag }}</td>
      <td>{{ rowData.CalculationReference }}</td>
      <td>
        <i
          class="pi"
          [ngClass]="
            rowData.Active
              ? 'pi-check-circle text-green-500'
              : 'pi-times-circle text-red-500'
          "
        ></i>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- ðŸ“¦ Actions -->
<div class="flex w-full justify-end gap-4 mt-6">
  <app-button label="Ø¨Ø§Ø±Ú¯Ø²Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„" severity="warn" />
  <app-button
    [disabled]="tariffs.length === 0"
    label="ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ¹Ø±ÙÙ‡"
    severity="danger"
  />
  <app-button
    [disabled]="tariffs.length === 0"
    label="Ø§ÙØ²Ø§ÛŒØ´ ØªØ¹Ø±ÙÙ‡"
    severity="info"
  />
</div>

<!-- ðŸ“ Tariff Dialog Form -->
<p-dialog
  [(visible)]="formDialogVisible"
  [modal]="true"
  [closable]="true"
  [header]="headerTitle"
  [style]="{ width: '30rem', maxWidth: '100%' }"
  (onHide)="closeDialogTariffForm()"
  draggable="false"
  maskStyleClass="px-2"
>
  <form
    [formGroup]="tariffForm"
    class="grid grid-cols-12 gap-4"
    (ngSubmit)="editTariffForm()"
  >
    <app-search-auto-complete
      class="col-span-12"
      placeholder="Ù†ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±"
      label="Ù†ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±"
      optionLabel="LoaderTypeTitle"
      optionValue="LoaderTypeTitle"
      (selectSuggestion)="onSelectLoaderType($event)"
      (valueChange)="onAutoCompleteChange(LoaderTypeId)"
      [lazySearch]="onSearchLoaderType"
      [showIconOptionSelected]="LoaderTypeId.value !== 0"
      [readOnly]="isTariffsFormReadonly()"
      [disabled]="isTariffsFormReadonly()"
      [addonWidth]="widthAddon"
    />

    <app-search-auto-complete
      class="col-span-12"
      placeholder="Ø´Ù‡Ø± Ù…Ø¨Ø¯Ø§"
      label="Ø´Ù‡Ø± Ù…Ø¨Ø¯Ø§"
      [control]="SourceCityTitle"
      optionLabel="CityTitle"
      optionValue="CityTitle"
      (selectSuggestion)="onSelectSourceCity($event)"
      (valueChange)="onAutoCompleteChange(SourceCityId)"
      [lazySearch]="onSearchCity"
      [showIconOptionSelected]="SourceCityId.value !== 0"
      [readOnly]="isTariffsFormReadonly()"
      [disabled]="isTariffsFormReadonly()"
      [addonWidth]="widthAddon"
    />

    <app-search-auto-complete
      class="col-span-12"
      placeholder="Ø´Ù‡Ø± Ù…Ù‚ØµØ¯"
      label="Ø´Ù‡Ø± Ù…Ù‚ØµØ¯"
      [control]="TargetCityTitle"
      optionLabel="CityTitle"
      optionValue="CityTitle"
      (selectSuggestion)="onSelectTargetCity($event)"
      (valueChange)="onAutoCompleteChange(TargetCityId)"
      [lazySearch]="onSearchCity"
      [showIconOptionSelected]="TargetCityId.value !== 0"
      [readOnly]="isTariffsFormReadonly()"
      [disabled]="isTariffsFormReadonly()"
      [addonWidth]="widthAddon"
    />

    <app-search-auto-complete
      class="col-span-12"
      placeholder="Ù†ÙˆØ¹ Ø¨Ø§Ø±"
      label="Ù†ÙˆØ¹ Ø¨Ø§Ø±"
      [control]="GoodTitle"
      optionLabel="ProductTitle"
      optionValue="ProductTitle"
      (selectSuggestion)="onSelectProduct($event)"
      (valueChange)="onAutoCompleteChange(GoodId)"
      [lazySearch]="onSearchProduct"
      [showIconOptionSelected]="GoodId.value !== 0"
      [readOnly]="isTariffsFormReadonly()"
      [disabled]="isTariffsFormReadonly()"
      [addonWidth]="widthAddon"
    />

    <app-text-input
      class="col-span-12"
      label="Ù…Ø¨Ù†Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡"
      [control]="CalculationReference"
      [readOnly]="true"
      addonWidth="7rem"
    />

    <!-- Editable Fields -->
    <app-text-input
      class="col-span-12"
      label="ØªØ¹Ø±ÙÙ‡"
      [control]="Tariff"
      inputType="number"
      addonWidth="7rem"
    />

    <app-text-input
      class="col-span-12"
      label="ØªÙ†Ø§Ú˜ Ù¾Ø§ÛŒÙ‡"
      [control]="BaseTonnag"
      inputType="number"
      addonWidth="7rem"
    />

    <app-binary-radio-input
      class="col-span-12 flex px-3"
      label="ÙˆØ¶Ø¹ÛŒØª"
      [control]="Active"
      [disabled]="true"
    />

    <!-- Submit -->
    <div class="col-span-12 flex justify-end mt-4">
      <app-button
        label="Ø«Ø¨Øª ØªØºÛŒÛŒØ±Ø§Øª"
        type="submit"
        [disabled]="tariffForm.invalid || loading"
      />
    </div>
  </form>
</p-dialog>

<!-- Confirm Dialog -->
<p-confirm-dialog />
